imports:
  - { resource: services_cron.yml }
  - { resource: ../../Form/services.yml }
  - { resource: ../../Twig/services.yml }

parameters:
  fp_js_form_validator.factory.class: Shopsys\ShopBundle\Component\Validator\JsFormValidatorFactory
  prezent_doctrine_translatable.listener.class: Shopsys\ShopBundle\Model\Localization\TranslatableListener
  faker.seed: 1234

services:

  doctrine.orm.default_entity_manager:
    class: '%doctrine.orm.entity_manager.class%'
    factory: ['%doctrine.orm.entity_manager.class%', create]
    arguments:
      - '@doctrine.dbal.default_connection'
      - '@doctrine.orm.default_configuration'

  doctrine.orm.entity_manager.abstract:
    synthetic: true

  faker.generator:
    class: Faker\Generator
    factory: [Faker\Factory, create]
    calls:
      - [seed, ['%faker.seed%']]

  fragment.handler:
    class: Shopsys\ShopBundle\Component\HttpFoundation\FragmentHandler
    arguments:
      - '@service_container'
      - '@request_stack'
      - '%kernel.debug%'

  # disable original DefaultPhpFileExtractor
  jms_translation.extractor.file.default_php_extractor:
    alias: shopsys.shop.component.translation.php_file_extractor

  # normalize translation messages during extraction
  jms_translation.extractor_manager:
    alias: shopsys.shop.component.translation.normalizing_extractor_manager

  ninja_mutex.adapter:
    class: NinjaMutex\Lock\FlockLock
    arguments:
      - '%shopsys.root_dir%/var/lock'

  sensio_framework_extra.routing.loader.annot_class:
    class: Shopsys\ShopBundle\Component\AnnotatedRouteControllerLoader
    tags:
      - { name: 'routing.loader' }
    arguments:
      - '@annotation_reader'

  shopsys.doctrine.cache_driver.query_cache:
    class: Doctrine\Common\Cache\ChainCache
    arguments:
      -
        - '@shopsys.doctrine.cache_driver.query_cache.array'
        - '@shopsys.shop.component.doctrine.cache.query.permanent_php_file_cache'

  shopsys.doctrine.cache_driver.query_cache.array:
    class: Doctrine\Common\Cache\ArrayCache

  shopsys.doctrine.cache_driver.metadata_cache:
    class: Doctrine\Common\Cache\ChainCache
    arguments:
      -
        - '@shopsys.doctrine.cache_driver.metadata_cache.array'
        - '@shopsys.shop.component.doctrine.cache.metadata.permanent_php_file_cache'

  shopsys.doctrine.cache_driver.metadata_cache.array:
    class: Doctrine\Common\Cache\ArrayCache

  shopsys.shop.admin_navigation.menu_factory:
    class: Shopsys\ShopBundle\Model\AdminNavigation\MenuFactory
    arguments:
      - '%shopsys.admin_navigation.config_filepath%'
      - '@security.authorization_checker'

  shopsys.shop.admin_navigation.menu_loader:
    class: Shopsys\ShopBundle\Model\AdminNavigation\MenuLoader

  shopsys.shop.administrator.administrator_facade:
    class: Shopsys\ShopBundle\Model\Administrator\AdministratorFacade

  shopsys.shop.administrator.security.administrator_user_provider:
    class: Shopsys\ShopBundle\Model\Administrator\Security\AdministratorUserProvider

  shopsys.shop.advert.advert_facade:
    class: Shopsys\ShopBundle\Model\Advert\AdvertFacade

  shopsys.shop.article.article_facade:
    class: Shopsys\ShopBundle\Model\Article\ArticleFacade

  shopsys.shop.breadcrumb.front_breadcrumb_resolver:
    class: Shopsys\ShopBundle\Component\Breadcrumb\BreadcrumbResolver
    factory: ['@shopsys.shop.breadcrumb.front_breadcrumb_resolver_factory', create]

  shopsys.shop.breadcrumb.front_breadcrumb_resolver_factory:
    class: Shopsys\ShopBundle\Model\Breadcrumb\FrontBreadcrumbResolverFactory

  shopsys.shop.cart.cart_migration_facade:
    class: Shopsys\ShopBundle\Model\Cart\CartMigrationFacade
    tags:
      - { name: kernel.event_listener, event: kernel.controller, method: onKernelController }

  shopsys.shop.cart.cart_watcher_facade:
    class: Shopsys\ShopBundle\Model\Cart\Watcher\CartWatcherFacade
    arguments:
      - '@shopsys.shop.component.flash_message.sender.front'

  shopsys.shop.category.category_data_factory:
    class: Shopsys\ShopBundle\Model\Category\CategoryDataFactory

  shopsys.shop.category.category_facade:
    class: Shopsys\ShopBundle\Model\Category\CategoryFacade

  shopsys.shop.category.category_visibility_repository:
    class: Shopsys\ShopBundle\Model\Category\CategoryVisibilityRepository
    tags:
      # must be ran before ProductVisibilityFacade
      - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse, priority: 20 }

  shopsys.shop.category.top_category.top_category_facade:
    class: Shopsys\ShopBundle\Model\Category\TopCategory\TopCategoryFacade

  shopsys.shop.component.cron.config.cron_config:
    class: Shopsys\ShopBundle\Component\Cron\Config\CronConfig

  shopsys.shop.component.cron.cron_facade:
    class: Shopsys\ShopBundle\Component\Cron\CronFacade
    arguments:
      - '@monolog.logger.cron'

  shopsys.shop.component.css.css_facade:
      class: Shopsys\ShopBundle\Component\Css\CssFacade
      arguments:
        - '%shopsys.css_version_filepath%'

  shopsys.shop.component.data_fixture.persistent_reference_facade:
    class: Shopsys\ShopBundle\Component\DataFixture\PersistentReferenceFacade

  shopsys.shop.component.data_fixture.product_data_fixture_reference_injector:
    class: Shopsys\ShopBundle\Component\DataFixture\ProductDataFixtureReferenceInjector

  shopsys.shop.component.doctrine.cache.metadata.permanent_php_file_cache:
      class: Shopsys\ShopBundle\Component\Doctrine\Cache\PermanentPhpFileCache
      arguments:
        - '%shopsys.doctrine.metadata_cache_directory_path%'

  shopsys.shop.component.doctrine.cache.query.permanent_php_file_cache:
      class: Shopsys\ShopBundle\Component\Doctrine\Cache\PermanentPhpFileCache
      arguments:
        - '%shopsys.doctrine.query_cache_directory_path%'

  shopsys.shop.component.doctrine.database_schema_facade:
      class: Shopsys\ShopBundle\Component\Doctrine\DatabaseSchemaFacade
      arguments:
        - '%shopsys.default_db_schema_filepath%'

  shopsys.shop.component.domain:
    class: Shopsys\ShopBundle\Component\Domain\Domain
    factory: ['@shopsys.shop.component.domain.domain_factory', create]
    arguments:
      - '%shopsys.domain_config_filepath%'
      - '%shopsys.domain_urls_config_filepath%'

  shopsys.shop.component.domain.domain_aware_security_headers_setter:
    class: Shopsys\ShopBundle\Component\Domain\DomainAwareSecurityHeadersSetter
    tags:
      - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse }

  shopsys.shop.component.domain.domain_data_creator:
    class: Shopsys\ShopBundle\Component\Domain\DomainDataCreator

  shopsys.shop.component.domain.domain_db_functions_facade:
    class: Shopsys\ShopBundle\Component\Domain\DomainDbFunctionsFacade

  shopsys.shop.component.domain.domain_facade:
    class: Shopsys\ShopBundle\Component\Domain\DomainFacade
    arguments:
      - '%shopsys.domain_images_dir%'

  shopsys.shop.component.domain.domain_factory:
    class: Shopsys\ShopBundle\Component\Domain\DomainFactory

  shopsys.shop.component.domain.domain_subscriber:
    class: Shopsys\ShopBundle\Component\Domain\DomainSubscriber
    tags:
      - { name: kernel.event_subscriber }

  shopsys.shop.component.domain.domain_service:
    class: Shopsys\ShopBundle\Component\Domain\DomainService
    arguments:
      - '@monolog.logger'

  shopsys.shop.component.domain.domain_url_service:
    class: Shopsys\ShopBundle\Component\Domain\DomainUrlService

  shopsys.shop.component.domain.multidomain.multidomain_entity_class_finder_facade:
    class: Shopsys\ShopBundle\Component\Domain\Multidomain\MultidomainEntityClassFinderFacade

  shopsys.shop.component.error.error_pages_facade:
    class: Shopsys\ShopBundle\Component\Error\ErrorPagesFacade
    arguments:
      - '%shopsys.error_pages_dir%'

  shopsys.shop.component.error.exception_listener:
    class: Shopsys\ShopBundle\Component\Error\ExceptionListener
    tags:
      - { name: kernel.event_listener, event: kernel.exception, method: onKernelException }

  shopsys.shop.component.error.reporting.log_error_reporting_facade:
    class: Shopsys\ShopBundle\Component\Error\Reporting\LogErrorReportingFacade
    arguments:
      - '%kernel.logs_dir%'

  shopsys.shop.component.file_upload:
    class: Shopsys\ShopBundle\Component\FileUpload\FileUpload
    arguments: ['%kernel.cache_dir%', '%shopsys.uploaded_file_dir%', '%shopsys.image_dir%']

  shopsys.shop.component.file_upload.doctrine_listener:
    class: Shopsys\ShopBundle\Component\FileUpload\DoctrineListener
    tags:
      - { name: doctrine.event_listener, event: postPersist }
      - { name: doctrine.event_listener, event: postUpdate }
      - { name: doctrine.event_listener, event: prePersist }
      - { name: doctrine.event_listener, event: preUpdate }

  shopsys.shop.component.flash_message.bag.admin:
    class: Shopsys\ShopBundle\Component\FlashMessage\Bag
    arguments: ['admin']

  shopsys.shop.component.flash_message.bag.front:
    class: Shopsys\ShopBundle\Component\FlashMessage\Bag
    arguments: ['front']

  shopsys.shop.component.flash_message.sender.admin:
    class: Shopsys\ShopBundle\Component\FlashMessage\FlashMessageSender
    arguments:
      - '@shopsys.shop.component.flash_message.bag.admin'

  shopsys.shop.component.flash_message.sender.front:
    class: Shopsys\ShopBundle\Component\FlashMessage\FlashMessageSender
    arguments:
      - '@shopsys.shop.component.flash_message.bag.front'

  shopsys.shop.component.form.multiple_form_setting:
    class: Shopsys\ShopBundle\Component\Form\MultipleFormSetting

  shopsys.shop.component.image.directory_structure_creator:
    class: Shopsys\ShopBundle\Component\Image\DirectoryStructureCreator
    arguments:
      - '%shopsys.image_dir%'
      - '%shopsys.domain_images_dir%'

  shopsys.shop.component.image.image_config:
    class: Shopsys\ShopBundle\Component\Image\Config\ImageConfig
    factory: ['@shopsys.shop.component.image.image_config_loader', loadFromYaml]
    arguments:
      - '%shopsys.image_config_filepath%'

  shopsys.shop.component.image.image_config_loader:
    class: Shopsys\ShopBundle\Component\Image\Config\ImageConfigLoader

  shopsys.shop.component.image.image_delete_doctrine_listener:
    class: Shopsys\ShopBundle\Component\Image\ImageDeleteDoctrineListener
    tags:
      - { name: doctrine.event_listener, event: preRemove }

  shopsys.shop.component.image.image_facade:
    class: Shopsys\ShopBundle\Component\Image\ImageFacade
    arguments: ['%shopsys.image_url_prefix%']

  shopsys.shop.component.image.image_locator:
    class: Shopsys\ShopBundle\Component\Image\ImageLocator
    arguments: ['%shopsys.image_dir%']

  shopsys.shop.component.image.processing.image_manager:
    class: Intervention\Image\ImageManager
    arguments:
      - [driver: 'gd']

  shopsys.shop.component.javascript.compiler.constant.js_constant_compiler_pass:
    class: Shopsys\ShopBundle\Component\Javascript\Compiler\Constant\JsConstantCompilerPass

  shopsys.shop.component.javascript.compiler.js_compiler:
    class: Shopsys\ShopBundle\Component\Javascript\Compiler\JsCompiler
    arguments:
      -
        - '@shopsys.shop.component.javascript.compiler.translator.js_translator_compiler_pass'
        - '@shopsys.shop.component.javascript.compiler.constant.js_constant_compiler_pass'

  shopsys.shop.component.javascript.compiler.translator.js_translator_compiler_pass:
    class: Shopsys\ShopBundle\Component\Javascript\Compiler\Translator\JsTranslatorCompilerPass

  shopsys.shop.component.javascript.parser.translator.js_translator_call_parser:
    class: Shopsys\ShopBundle\Component\Javascript\Parser\Translator\JsTranslatorCallParser
    factory: ['@shopsys.shop.component.javascript.parser.translator.js_translator_call_parser_factory', create]

  shopsys.shop.component.javascript.parser.translator.js_translator_call_parser_factory:
    class: Shopsys\ShopBundle\Component\Javascript\Parser\Translator\JsTranslatorCallParserFactory

  shopsys.shop.component.log.slow_log_facade:
    class: Shopsys\ShopBundle\Component\Log\SlowLogFacade
    arguments:
      - '@monolog.logger.slow'
    tags:
      - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest }
      - { name: kernel.event_listener, event: kernel.terminate, method: onKernelTerminate }

  shopsys.shop.component.mutex.mutex_factory:
    class: Shopsys\ShopBundle\Component\Mutex\MutexFactory

  shopsys.shop.component.plugin.plugin_crud_extension_registry:
    class: Shopsys\ShopBundle\Component\Plugin\PluginCrudExtensionRegistry

  shopsys.shop.component.request.deny_script_name_in_request_path_listener:
    class: Shopsys\ShopBundle\Component\Request\DenyScriptNameInRequestPathListener
    tags:
      - { name: kernel.event_subscriber }

  shopsys.shop.component.request.transactional_master_request_service:
    class: Shopsys\ShopBundle\Component\Request\TransactionalMasterRequestService
    tags:
      - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest }
      - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse }
      - { name: kernel.event_listener, event: kernel.exception, method: onKernelException }

  shopsys.shop.component.request.vary_response_by_x_requested_with_header_listener:
    class: Shopsys\ShopBundle\Component\Request\VaryResponseByXRequestedWithHeaderListener
    tags:
      - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse }

  shopsys.shop.component.router.friendly_url.friendly_url_generator_facade:
    class: Shopsys\ShopBundle\Component\Router\FriendlyUrl\FriendlyUrlGeneratorFacade

  shopsys.shop.component.setting:
    class: Shopsys\ShopBundle\Component\Setting\Setting

  shopsys.shop.component.sitemap.sitemap_dumper_factory:
    class: Shopsys\ShopBundle\Component\Sitemap\SitemapDumperFactory
    arguments:
      - '@event_dispatcher'

  shopsys.shop.component.sitemap.sitemap_facade:
    class: Shopsys\ShopBundle\Component\Sitemap\SitemapFacade
    arguments:
      - '%shopsys.sitemaps_dir%'
      - '%shopsys.sitemaps_url_prefix%'

  shopsys.shop.component.sitemap.sitemap_listener:
    class: Shopsys\ShopBundle\Component\Sitemap\SitemapListener
    tags:
      - { name: presta.sitemap.listener }

  shopsys.shop.component.string.hash_generator:
    class: Shopsys\ShopBundle\Component\String\HashGenerator

  shopsys.shop.component.system:
    class: Shopsys\ShopBundle\Component\System\System

  shopsys.shop.component.translation.normalizing_extractor_manager:
    class: Shopsys\ShopBundle\Component\Translation\NormalizingExtractorManager
    arguments:
      - '@jms_translation.extractor.file_extractor'
      - '@logger'

  shopsys.shop.component.translation.js_file_extractor:
    class: Shopsys\ShopBundle\Component\Translation\JsFileExtractor
    tags:
      - { name: jms_translation.file_visitor }

  shopsys.shop.component.translation.php_file_extractor:
    class: Shopsys\ShopBundle\Component\Translation\PhpFileExtractor
    factory: ['@shopsys.shop.component.translation.php_file_extractor_factory', create]
    tags:
      - { name: jms_translation.file_visitor }

  shopsys.shop.component.translation.php_file_extractor_factory:
    class: Shopsys\ShopBundle\Component\Translation\PhpFileExtractorFactory

  shopsys.shop.component.translation.constraint_message_extractor:
    class: Shopsys\ShopBundle\Component\Translation\ConstraintMessageExtractor
    tags:
      - { name: jms_translation.file_visitor }

  shopsys.shop.component.translation.admin_menu_yaml_file_extractor:
    class: Shopsys\ShopBundle\Component\Translation\AdminMenuYamlFileExtractor
    arguments:
      - '%shopsys.admin_navigation.config_filepath%'
    tags:
      - { name: jms_translation.file_visitor }

  shopsys.shop.component.translation.po_dumper:
    class: Shopsys\ShopBundle\Component\Translation\PoDumper
    tags:
      - { name: jms_translation.dumper, format: po }

  shopsys.shop.component.translation.translator:
    class: Shopsys\ShopBundle\Component\Translation\Translator
    decorates: translator
    arguments:
      - '@shopsys.shop.component.translation.translator.inner'
      - '@shopsys.shop.component.translation.translator.inner'
      - '@shopsys.shop.component.translation.identity_translator'

  shopsys.shop.component.translation.identity_translator:
    class: Symfony\Component\Translation\IdentityTranslator

  shopsys.shop.component.uploaded_file.config.uploaded_file_config:
    class: Shopsys\ShopBundle\Component\UploadedFile\Config\UploadedFileConfig
    factory: ['@shopsys.shop.component.uploaded_file.config.uploaded_file_config_loader', loadFromYaml]
    arguments:
      - '%shopsys.uploaded_file_config_filepath%'

  shopsys.shop.component.uploaded_file.config.uploaded_file_config_loader:
    class: Shopsys\ShopBundle\Component\UploadedFile\Config\UploadedFileConfigLoader

  shopsys.shop.component.uploaded_file.directory_structure_creator:
    class: Shopsys\ShopBundle\Component\UploadedFile\DirectoryStructureCreator

  shopsys.shop.component.uploaded_file.uploaded_file_delete_doctrine_listener:
    class: Shopsys\ShopBundle\Component\UploadedFile\UploadedFileDeleteDoctrineListener
    tags:
      - { name: doctrine.event_listener, event: preRemove }

  shopsys.shop.component.uploaded_file.uploaded_file_facade:
    class: Shopsys\ShopBundle\Component\UploadedFile\UploadedFileFacade

  shopsys.shop.component.uploaded_file.uploaded_file_locator:
    class: Shopsys\ShopBundle\Component\UploadedFile\UploadedFileLocator
    arguments:
      - '%shopsys.uploaded_file_dir%'
      - '%shopsys.uploaded_file_url_prefix%'

  shopsys.shop.component.validator.constraints.not_selected_domain_to_show:
    class: Shopsys\ShopBundle\Component\Constraints\NotSelectedDomainToShowValidator
    tags:
      - { name: validator.constraint_validator, alias: Shopsys\ShopBundle\Component\Constraints\NotSelectedDomainToShowValidator }

  shopsys.shop.component.validator.constraints.unique_slugs_on_domains:
    class: Shopsys\ShopBundle\Component\Constraints\UniqueSlugsOnDomainsValidator
    tags:
      - { name: validator.constraint_validator, alias: Shopsys\ShopBundle\Component\Constraints\UniqueSlugsOnDomainsValidator }

  shopsys.shop.country.country_inline_edit:
    class: Shopsys\ShopBundle\Model\Country\CountryInlineEdit

  shopsys.shop.cookies.cookies_facade:
    class: Shopsys\ShopBundle\Model\Cookies\CookiesFacade
    arguments:
      - '%kernel.environment%'

  shopsys.shop.country.country_facade:
    class: Shopsys\ShopBundle\Model\Country\CountryFacade

  shopsys.shop.customer.customer_facade:
    class: Shopsys\ShopBundle\Model\Customer\CustomerFacade

  shopsys.shop.customer.customer_password_service:
    class: Shopsys\ShopBundle\Model\Customer\CustomerPasswordService

  shopsys.shop.customer.frontend_user_provider:
    class: Shopsys\ShopBundle\Model\Customer\FrontendUserProvider

  shopsys.shop.customer.user_repository:
    class: Shopsys\ShopBundle\Model\Customer\UserRepository

  shopsys.shop.data_fixtures.demo.product_data_fixture_loader:
    class: Shopsys\ShopBundle\DataFixtures\Demo\ProductDataFixtureLoader

  shopsys.shop.data_fixtures.performance.category_data_fixture:
    class: Shopsys\ShopBundle\DataFixtures\Performance\CategoryDataFixture

  shopsys.shop.data_fixtures.performance.order_data_fixture:
    class: Shopsys\ShopBundle\DataFixtures\Performance\OrderDataFixture

  shopsys.shop.data_fixtures.performance.product_data_fixture:
    class: Shopsys\ShopBundle\DataFixtures\Performance\ProductDataFixture

  shopsys.shop.data_fixtures.performance.user_data_fixture:
    class: Shopsys\ShopBundle\DataFixtures\Performance\UserDataFixture

  shopsys.shop.data_fixtures.product_data_fixture_csv_reader:
    class: Shopsys\ShopBundle\DataFixtures\Demo\ProductDataFixtureCsvReader
    arguments:
      - '%shopsys.data_fixtures.resource_products_filepath%'

  shopsys.shop.data_fixtures.user_data_fixture_loader:
    class: Shopsys\ShopBundle\DataFixtures\Demo\UserDataFixtureLoader
    arguments:
      - '%shopsys.data_fixtures.resource_customers_filepath%'

  shopsys.shop.feed.category.feed_category_loader_facade:
    class: Shopsys\ShopBundle\Model\Feed\Category\FeedCategoryLoaderFacade
    arguments:
      - '%shopsys.heureka_category_feed_url%'
      - '%shopsys.heureka_category_feed_backup_filepath%'

  shopsys.shop.feed.feed_config_facade:
    class: Shopsys\ShopBundle\Model\Feed\FeedConfigFacade
    arguments:
      - '%shopsys.feed_url_prefix%'
      - '%shopsys.feed_dir%'

  shopsys.shop.feed.feed_config_repository:
    class: Shopsys\ShopBundle\Model\Feed\FeedConfigRepository

  shopsys.shop.feed.feed_item_custom_values_provider:
    class: Shopsys\ShopBundle\Model\Feed\FeedItemCustomValuesProvider

  shopsys.shop.feed.feed_item_repository:
    class: Shopsys\ShopBundle\Model\Feed\Standard\StandardFeedItemRepository

  shopsys.shop.feed.heureka.heureka_delivery_feed_config:
    class: Shopsys\ShopBundle\Model\Feed\HeurekaDelivery\HeurekaDeliveryFeedConfig
    tags:
      - { name: shopsys.product_feed, type: delivery }

  shopsys.shop.http_foundation.response_listener:
    class: Shopsys\ShopBundle\Component\HttpFoundation\ResponseListener
    tags:
      - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse }

  shopsys.shop.http_foundation.sub_request_listener:
    class: Shopsys\ShopBundle\Component\HttpFoundation\SubRequestListener
    tags:
      - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse }
      - { name: kernel.event_listener, event: kernel.controller, method: onKernelController }

  shopsys.shop.localization:
    class: Shopsys\ShopBundle\Model\Localization\Localization

  shopsys.shop.localization.custom_date_time_formatter:
    class: Shopsys\ShopBundle\Component\Localization\DateTimeFormatter
    factory: ['@shopsys.shop.localization.custom_date_time_formatter_factory', create]

  shopsys.shop.localization.custom_date_time_formatter_factory:
    class: Shopsys\ShopBundle\Model\Localization\CustomDateTimeFormatterFactory

  shopsys.shop.localization.intl_currency_repository:
    class: Shopsys\ShopBundle\Model\Localization\IntlCurrencyRepository

  shopsys.shop.localization.locale_listener:
    class: Shopsys\ShopBundle\Model\Localization\LocalizationListener
    tags:
      - { name: kernel.event_subscriber }

  shopsys.shop.localization.number_format_repository:
    class: CommerceGuys\Intl\NumberFormat\NumberFormatRepository

  shopsys.shop.mail.mail_template_facade:
    class: Shopsys\ShopBundle\Model\Mail\MailTemplateFacade

  shopsys.shop.mail.mailer_service:
    class: Shopsys\ShopBundle\Model\Mail\MailerService
    arguments: ['@mailer']

  shopsys.shop.module.module_facade:
    class: Shopsys\ShopBundle\Model\Module\ModuleFacade

  shopsys.shop.order.order_facade:
    class: Shopsys\ShopBundle\Model\Order\OrderFacade

  shopsys.shop.order.preview.order_preview_factory:
    class: Shopsys\ShopBundle\Model\Order\Preview\OrderPreviewFactory

  shopsys.shop.heureka.heureka_facade:
    class: Shopsys\ShopBundle\Model\Heureka\HeurekaFacade
    arguments:
      - '@logger'

  shopsys.shop.order.order_transport_and_payment_watcher_service:
    class: Shopsys\ShopBundle\Model\Order\Watcher\TransportAndPaymentWatcherService
    arguments:
      - '@shopsys.shop.component.flash_message.bag.front'

  shopsys.shop.order.promo_code.grid.promo_code_inline_edit:
    class: Shopsys\ShopBundle\Model\Order\PromoCode\Grid\PromoCodeInlineEdit

  shopsys.shop.order.promo_code.promo_code_facade:
    class: Shopsys\ShopBundle\Model\Order\PromoCode\PromoCodeFacade

  shopsys.shop.order.status.grid.order_status_inline_edit:
    class: Shopsys\ShopBundle\Model\Order\Status\Grid\OrderStatusInlineEdit

  shopsys.shop.payment.payment_facade:
    class: Shopsys\ShopBundle\Model\Payment\PaymentFacade

  shopsys.shop.plugin_data.plugin_data_storage_provider:
    class: Shopsys\ShopBundle\Model\PluginData\DoctrinePluginDataStorageProvider

  shopsys.shop.pricing.currency.currency_facade:
    class: Shopsys\ShopBundle\Model\Pricing\Currency\CurrencyFacade

  shopsys.shop.pricing.currency.grid.currency_inline_edit:
    class: Shopsys\ShopBundle\Model\Pricing\Currency\Grid\CurrencyInlineEdit

  shopsys.shop.pricing.group.grid.pricing_group_inline_edit:
    class: Shopsys\ShopBundle\Model\Pricing\Group\Grid\PricingGroupInlineEdit

  shopsys.shop.pricing.group.pricing_group_facade:
    class: Shopsys\ShopBundle\Model\Pricing\Group\PricingGroupFacade

  shopsys.shop.pricing.input_price_recalculation_scheduler:
    class: Shopsys\ShopBundle\Model\Pricing\InputPriceRecalculationScheduler
    tags:
      - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse }

  shopsys.shop.pricing.vat.vat_facade:
    class: Shopsys\ShopBundle\Model\Pricing\Vat\VatFacade

  shopsys.shop.pricing.vat.vat_inline_edit:
    class: Shopsys\ShopBundle\Model\Pricing\Vat\VatInlineEdit

  shopsys.shop.product.availability.availability_facade:
    class: Shopsys\ShopBundle\Model\Product\Availability\AvailabilityFacade

  shopsys.shop.product.availability.availability_inline_edit:
    class: Shopsys\ShopBundle\Model\Product\Availability\AvailabilityInlineEdit

  shopsys.shop.product.availability.product_availability_recalculator:
    class: Shopsys\ShopBundle\Model\Product\Availability\ProductAvailabilityRecalculator
    tags:
      - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse }

  shopsys.shop.product.bestselling_product.cache_provider:
    class: Doctrine\Common\Cache\FilesystemCache
    arguments:
      - '%shopsys.bestselling_product.cache_directory_path%'

  shopsys.shop.product.bestselling_product.cached_bestselling_product_facade:
    class: Shopsys\ShopBundle\Model\Product\BestsellingProduct\CachedBestsellingProductFacade
    arguments:
      - '@shopsys.shop.product.bestselling_product.cache_provider'

  shopsys.shop.product.bestselling_product.manual_bestselling_product_facade:
    class: Shopsys\ShopBundle\Model\Product\BestsellingProduct\ManualBestsellingProductFacade

  shopsys.shop.product.brand.brand_facade:
    class: Shopsys\ShopBundle\Model\Product\Brand\BrandFacade

  shopsys.shop.product.brand.brand_edit_data_factory:
    class: Shopsys\ShopBundle\Model\Product\Brand\BrandEditDataFactory

  shopsys.shop.product.flag.flag_facade:
    class: Shopsys\ShopBundle\Model\Product\Flag\FlagFacade

  shopsys.shop.product.flag.flag_inline_edit:
    class: Shopsys\ShopBundle\Model\Product\Flag\FlagInlineEdit

  shopsys.shop.product.parameter.parameter.parameter_inline_edit:
    class: Shopsys\ShopBundle\Model\Product\Parameter\ParameterInlineEdit

  shopsys.shop.product.pricing.product_price_recalculator:
    class: Shopsys\ShopBundle\Model\Product\Pricing\ProductPriceRecalculator
    tags:
      # must be run before ProductVisibilityFacade
      - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse, priority: 20 }

  shopsys.shop.product.product_edit_data_factory:
    class: Shopsys\ShopBundle\Model\Product\ProductEditDataFactory

  shopsys.shop.product.product_facade:
    class: Shopsys\ShopBundle\Model\Product\ProductFacade

  shopsys.shop.product.product_hidden_recalculator:
    class: Shopsys\ShopBundle\Model\Product\ProductHiddenRecalculator

  shopsys.shop.product.product_selling_denied_recalculator:
    class: Shopsys\ShopBundle\Model\Product\ProductSellingDeniedRecalculator

  shopsys.shop.product.product_variant_facade:
    class: Shopsys\ShopBundle\Model\Product\ProductVariantFacade

  shopsys.shop.product.product_visibility_facade:
    class: Shopsys\ShopBundle\Model\Product\ProductVisibilityFacade
    tags:
      # must be ran after CategoryVisibilityRepository and ProductPriceRecalculator
      - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse, priority: 10 }

  shopsys.shop.product.top_product.top_product_facade:
    class: Shopsys\ShopBundle\Model\Product\TopProduct\TopProductFacade

  shopsys.shop.product.unit.unit_facade:
    class: Shopsys\ShopBundle\Model\Product\Unit\UnitFacade

  shopsys.shop.product.unit.unit_inline_edit:
    class: Shopsys\ShopBundle\Model\Product\Unit\UnitInlineEdit

  # Define RedicrectController explicitly to prevent creating it on-the-fly
  # when redirecting (it causes unnecessary container rebuild).
  shopsys.shop.redirect_controller:
    class: Symfony\Bundle\FrameworkBundle\Controller\RedirectController
    calls:
      - [setContainer, ['@service_container']]

  shopsys.shop.router.current_domain_router:
    class: Shopsys\ShopBundle\Component\Router\CurrentDomainRouter
    tags:
      - { name: router, priority: 70 }

  shopsys.shop.router.domain_router_factory:
    class: Shopsys\ShopBundle\Component\Router\DomainRouterFactory
    arguments: ['%router.resource%']

  shopsys.shop.router.friendly_url.friendly_url_router_factory:
    class: Shopsys\ShopBundle\Component\Router\FriendlyUrl\FriendlyUrlRouterFactory
    arguments: ['%shopsys.router.friendly_url_router_filepath%']

  shopsys.shop.router.localized_router_factory:
    class: Shopsys\ShopBundle\Component\Router\LocalizedRouterFactory
    arguments: ['%shopsys.router.locale_router_filepaths%']

  shopsys.shop.router.security.route_csrf_protector:
    class: Shopsys\ShopBundle\Component\Router\Security\RouteCsrfProtector
    arguments:
      - '@annotations.reader'
    tags:
      - { name: kernel.event_subscriber }

  shopsys.shop.script.script_facade:
    class: Shopsys\ShopBundle\Model\Script\ScriptFacade

  shopsys.shop.security.admin_logout_handler:
    class: Shopsys\ShopBundle\Model\Security\AdminLogoutHandler

  shopsys.shop.security.administrator_login_facade:
    class: Shopsys\ShopBundle\Model\Security\AdministratorLoginFacade
    arguments:
      - '@security.token_storage'
      - '@event_dispatcher'

  shopsys.shop.security.customer_login_handler:
    class: Shopsys\ShopBundle\Model\Security\CustomerLoginHandler

  shopsys.shop.security.filesystem.filemanager_access:
    class: Shopsys\ShopBundle\Model\Security\Filesystem\FilemanagerAccess
    arguments:
      - '%shopsys.filemanager_upload_dir%'

  shopsys.shop.security.front_logout_handler:
    class: Shopsys\ShopBundle\Model\Security\FrontLogoutHandler

  shopsys.shop.security.login_as_user_facade:
    class: Shopsys\ShopBundle\Model\Security\LoginAsUserFacade
    arguments:
      - '@security.token_storage'
      - '@event_dispatcher'

  shopsys.shop.security.login_listener:
    class: Shopsys\ShopBundle\Model\Security\LoginListener
    tags:
      - { name: kernel.event_listener, event: security.interactive_login, method: onSecurityInteractiveLogin }

  shopsys.shop.slider.slider_item_facade:
    class: Shopsys\ShopBundle\Model\Slider\SliderItemFacade

  shopsys.shop.transport.transport_facade:
    class: Shopsys\ShopBundle\Model\Transport\TransportFacade

  shopsys.shop.twig.javascript.javascript_compiler_service:
    class: Shopsys\ShopBundle\Twig\Javascript\JavascriptCompilerService
    arguments:
      - '%shopsys.root_dir%'
      - '%shopsys.web_dir%'
      - '%shopsys.javascript_sources_dir%'
      - '%shopsys.javascript_url_prefix%'

  translation.loader.po:
    class: Shopsys\ShopBundle\Component\Translation\PoFileLoader
    tags:
      - { name: 'translation.loader', alias: 'po' }

  twig.controller.exception:
    class: Shopsys\ShopBundle\Component\Error\ExceptionController
    arguments:
      - '@twig'
      - '%kernel.debug%'

  twig.exception_listener:
    class: Shopsys\ShopBundle\Component\Error\NotLogFakeHttpExceptionsExceptionListener
    tags:
      - { name: 'kernel.event_subscriber' }
      - { name: 'monolog.logger', channel: 'request' }
    arguments:
      - '%twig.exception_listener.controller%'
      - '@?logger'

  twig.stringloader:
    class: Twig_Loader_Array
    tags:
      - { name: twig.loader }
