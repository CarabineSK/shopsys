imports:
  - { resource: ../../Twig/services.yml }

parameters:
  sensio_framework_extra.routing.loader.annot_class.class: SS6\ShopBundle\Component\AnnotatedRouteControllerLoader
  ss6.admin_navigation.config_filepath: %kernel.root_dir%/../src/SS6/ShopBundle/Resources/config/admin_menu.yml
  ss6.file_dir: %kernel.root_dir%/../web/assets/content/files
  ss6.file_url_prefix: /assets/content/files/
  ss6.image_dir: %kernel.root_dir%/../web/assets/content/images
  ss6.image_url_prefix: /assets/content/images/
  ss6.image_config_filepath: %kernel.root_dir%/../src/SS6/ShopBundle/Resources/config/images.yml
  twig.controller.exception.class: SS6\ShopBundle\Component\ExceptionController

services:
  
  doctrine.orm.default_entity_manager:
    class: %doctrine.orm.entity_manager.class%
    factory_class: %doctrine.orm.entity_manager.class%
    factory_method: create
    arguments: 
      - @doctrine.dbal.default_connection
      - @doctrine.orm.default_configuration
  
  doctrine.orm.entity_manager.abstract:
    synthetic: true
    
  ss6.shop.administrator.administrator_grid_facade:
    class: SS6\ShopBundle\Model\Administrator\AdministratorGridFacade
    
  ss6.shop.administrator.administrator_grid_service:
    class: SS6\ShopBundle\Model\Administrator\AdministratorGridService

  ss6.shop.admin_navigation.breadcrumb:
    class: SS6\ShopBundle\Model\AdminNavigation\Breadcrumb
    factory_service: ss6.shop.admin_navigation.breadcrumb_singleton_factory
    factory_method: get

  ss6.shop.admin_navigation.breadcrumb_singleton_factory:
    class: SS6\ShopBundle\Model\AdminNavigation\BreadcrumbSingletonFactory

  ss6.shop.admin_navigation.menu:
    class: SS6\ShopBundle\Model\AdminNavigation\Menu
    factory_service: ss6.shop.admin_navigation.menu_loader
    factory_method: loadFromYaml
    arguments:
      - %ss6.admin_navigation.config_filepath%

  ss6.shop.admin_navigation.menu_loader:
    class: SS6\ShopBundle\Model\AdminNavigation\MenuLoader

  ss6.shop.article.article_repository:
    class: SS6\ShopBundle\Model\Article\ArticleRepository

  ss6.shop.article.article_edit_facade:
    class: SS6\ShopBundle\Model\Article\ArticleEditFacade

  ss6.shop.cart:
    class: SS6\ShopBundle\Model\Cart\Cart
    factory_service: ss6.shop.cart.cart_singleton_factory
    factory_method: get
    arguments: 
      - @ss6.shop.customer.customer_identifier
    
  ss6.shop.cart.cart_singleton_factory:
    class: SS6\ShopBundle\Model\Cart\CartSingletonFactory
    
  ss6.shop.cart.cart_facade:
    class: SS6\ShopBundle\Model\Cart\CartFacade

  ss6.shop.cart.cart_item_repository:
    class: SS6\ShopBundle\Model\Cart\CartItemRepository
    
  ss6.shop.cart.cart_migration_facade:
    class: SS6\ShopBundle\Model\Cart\CartMigrationFacade
    tags:
      - { name: kernel.event_listener, event: kernel.controller, method: onKernelController }

  ss6.shop.cart.cart_service:
    class: SS6\ShopBundle\Model\Cart\CartService

  ss6.shop.cart.cart_watcher_facade:
    class: SS6\ShopBundle\Model\Cart\Watcher\CartWatcherFacade
    arguments:
      - @ss6.shop.flash_message.bag.front

  ss6.shop.cart.cart_watcher_service:
    class: SS6\ShopBundle\Model\Cart\Watcher\CartWatcherService
    arguments:
      - @ss6.shop.flash_message.bag.front

  ss6.shop.customer.customer_identifier:
    class: SS6\ShopBundle\Model\Customer\CustomerIdentifier
    factory_service: ss6.shop.customer.customer_identifier_factory
    factory_method: get
    
  ss6.shop.file_upload:
    class: SS6\ShopBundle\Model\FileUpload\FileUpload
    arguments: [%kernel.cache_dir%, %ss6.file_dir%, %ss6.image_dir%]
    
  ss6.shop.file_upload.doctrine_listener:
    class: SS6\ShopBundle\Model\FileUpload\DoctrineListener
    tags:
      - { name: doctrine.event_listener, event: postPersist }
      - { name: doctrine.event_listener, event: postUpdate }
      - { name: doctrine.event_listener, event: prePersist }
      - { name: doctrine.event_listener, event: preUpdate }
      
  ss6.shop.file_upload.file_naming_convention:
    class: SS6\ShopBundle\Model\FileUpload\FileNamingConvention
    
  ss6.shop.customer.customer_identifier_factory:
    class: SS6\ShopBundle\Model\Customer\CustomerIdentifierFactory

  ss6.shop.customer.customer_edit_facade:
    class: SS6\ShopBundle\Model\Customer\CustomerEditFacade

  ss6.shop.customer.customer_edit_service:
    class: SS6\ShopBundle\Model\Customer\CustomerEditService

  ss6.shop.customer.registration_service:
    class: SS6\ShopBundle\Model\Customer\RegistrationService

  ss6.shop.customer.user_repository:
    class: SS6\ShopBundle\Model\Customer\UserRepository

  ss6.shop.flash_message.bag.admin:
    class: SS6\ShopBundle\Model\FlashMessage\Bag
    arguments: ['admin']

  ss6.shop.flash_message.bag.front:
    class: SS6\ShopBundle\Model\FlashMessage\Bag
    arguments: ['front']
    
  ss6.shop.image.image_config:
    class: SS6\ShopBundle\Model\Image\Config\ImageConfig
    factory_service: ss6.shop.image.image_config_loader
    factory_method: loadFromYaml
    arguments:
      - %ss6.image_config_filepath%

  ss6.shop.image.image_config_loader:
    class: SS6\ShopBundle\Model\Image\Config\ImageConfigLoader
    
  ss6.shop.image.images_entity:
    class: SS6\ShopBundle\Model\Image\ImagesEntity
    arguments: [%ss6.image_dir%]

  ss6.shop.flash_message.text_sender.admin:
    class: SS6\ShopBundle\Model\FlashMessage\TextSender
    arguments:
      - @ss6.shop.flash_message.bag.admin

  ss6.shop.flash_message.text_sender.front:
    class: SS6\ShopBundle\Model\FlashMessage\TextSender
    arguments:
      - @ss6.shop.flash_message.bag.front

  ss6.shop.flash_message.twig_sender.admin:
    class: SS6\ShopBundle\Model\FlashMessage\TwigSender
    arguments:
      - @ss6.shop.flash_message.bag.admin

  ss6.shop.flash_message.twig_sender.front:
    class: SS6\ShopBundle\Model\FlashMessage\TwigSender
    arguments:
      - @ss6.shop.flash_message.bag.front

  ss6.shop.order.flow:
    class: SS6\ShopBundle\Form\Front\Order\OrderFlow
    parent: craue.form.flow
    scope: request

  ss6.shop.order.order_facade:
    class: SS6\ShopBundle\Model\Order\OrderFacade
  
  ss6.shop.order.order_mail_facade:
    class: SS6\ShopBundle\Model\Order\Mail\OrderMailFacade
    arguments: [@mailer]
    
  ss6.shop.order.order_mail_service:
    class: SS6\ShopBundle\Model\Order\Mail\OrderMailService
    arguments: ["%main_email%"]
    
  ss6.shop.order.order_repository:
    class: SS6\ShopBundle\Model\Order\OrderRepository
    
  ss6.shop.order.order_review_service:
    class: SS6\ShopBundle\Model\Order\Review\OrderReviewService
    
  ss6.shop.order.order_service:
    class: SS6\ShopBundle\Model\Order\OrderService
  
  ss6.shop.order.order_status_facade:
    class: SS6\ShopBundle\Model\Order\Status\OrderStatusFacade
    
  ss6.shop.order.order_status_repository:
    class: SS6\ShopBundle\Model\Order\Status\OrderStatusRepository
    
  ss6.shop.order.order_status_service:
    class: SS6\ShopBundle\Model\Order\Status\OrderStatusService

  ss6.shop.order.order_repository:
    class: SS6\ShopBundle\Model\Order\OrderRepository

  ss6.shop.order.order_service:
    class: SS6\ShopBundle\Model\Order\OrderService

  ss6.shop.order.order_number_sequence_repository:
    class: SS6\ShopBundle\Model\Order\OrderNumberSequenceRepository
    
  ss6.shop.order.order_transport_and_payment_watcher_service:
    class: SS6\ShopBundle\Model\Order\Watcher\TransportAndPaymentWatcherService
    arguments:
      - @ss6.shop.flash_message.bag.front

  ss6.shop.payment.payment_edit_facade:
    class: SS6\ShopBundle\Model\Payment\PaymentEditFacade

  ss6.shop.payment.payment_repository:
    class: SS6\ShopBundle\Model\Payment\PaymentRepository

  ss6.shop.product.product_edit_facade:
    class: SS6\ShopBundle\Model\Product\ProductEditFacade
  
  ss6.shop.product.product_repository:
    class: SS6\ShopBundle\Model\Product\ProductRepository
    
  ss6.shop.product.product_visibility_facade:
    class: SS6\ShopBundle\Model\Product\ProductVisibilityFacade
    tags:
      - { name: kernel.event_listener, event: kernel.response, method: onKernelResponse }
    
  ss6.shop.product.product_visibility_repository:
    class: SS6\ShopBundle\Model\Product\ProductVisibilityRepository
  
  ss6.shop.security.login_listener:
    class: SS6\ShopBundle\Model\Security\LoginListener
    tags:
      - { name: kernel.event_listener, event: security.interactive_login, method: onSecurityInteractiveLogin }
    
  ss6.shop.security.login_service:
    class: SS6\ShopBundle\Model\Security\LoginService

  ss6.shop.transport.transport_edit_facade:
    class: SS6\ShopBundle\Model\Transport\TransportEditFacade

  ss6.shop.transport.transport_repository:
    class: SS6\ShopBundle\Model\Transport\TransportRepository

  twig.stringloader:
    class: Twig_Loader_String
    tags:
      - { name: twig.loader }
