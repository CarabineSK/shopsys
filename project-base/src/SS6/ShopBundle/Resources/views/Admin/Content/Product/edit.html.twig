{% extends '@SS6Shop/Admin/Content/Product/detail.html.twig' %}

{% block title -%}
	- {{ 'Editace zboží'|trans }} - {{ product|productDisplayName }}
{% endblock %}

{% block product_header_heading %}
	<span>{{ 'Editace zboží: '|trans }}</span> {{ product.name }}
{% endblock %}

{% block menu_panel_visibilities %}
	<div class="form-full__title__in">
		{{ 'Viditelnost'|trans }}
	</div>
	{% for productDomain in productDetail.productDomainsIndexedByDomainId %}
		<div class="form-line">
			{% set url = findUrlByDomainId('front_product_detail', { id: productDetail.product.id }, productDomain.domainId) %}
			{% set isVisibile = isVisibileForDefaultPricingGroup(productDetail.product, productDomain.domainId) %}

			{{ domainIcon(productDomain.domainId) }}

			{% if isVisibile %}
				<a href="{{ url }}" target="_blank">
					{{ getDomainName(productDomain.domainId) }}
					<i class="svg svg-forward-page"></i>
				</a>
			{% else %}
				{{ getDomainName(productDomain.domainId) }}
			{% endif %}

			<span class="in-icon svg svg-{{ isVisibile ? 'visible in-icon--visible' : 'invisible in-icon--invisible' }}" title="{{ isVisibile ? 'Ano'|trans : 'Ne'|trans }}"></span>

			{% if productDetail.product.calculatedSellingDenied %}
				<span class="in-icon in-icon--denied svg svg-cart" title="{{ 'Zboží je vyřazeno z prodeje'|trans }}"></span>
			{% endif %}
		</div>
	{% endfor %}
{% endblock %}

{% block product_variants %}
	{% if product.isVariant %}
		<div class="wrap-border">
			<div class="form-line">
				<strong>
					{{ 'Produkt je variantou'|trans }}
					<a href="{{ url('admin_product_edit', {id: product.mainVariant.id}) }}" target="_blank">
						<i class="svg svg-forward-page in-icon in-icon--link ml5 mr5"></i>{{ product.mainVariant.name }}
					</a>
				</strong>
			</div>
			{{ form_row(form.productData.variantAlias, { label: 'Alias varianty'|trans }) }}
		</div>
	{% endif %}
	{% if product.isMainVariant %}
		<div class="wrap-border">
			{% if product.variants|length > 0 %}
				<strong>
					{{ 'Produkt je hlavní variantou a má nastaveny varianty'|trans }}:
					<ul>
						{% for variant in product.variants %}
							<li>
								<a href="{{ url('admin_product_edit', {id: variant.id}) }}" target="_blank">
									{{ variant.name }}<i class="svg svg-forward-page"></i>
								</a>
							</li>
						{% endfor %}
					</ul>
				</strong>
			{% else %}
				<strong>{{ 'Produkt je hlavní variantou.'|trans }}</strong>
			{% endif %}
			{{ form_row(form.variants, { label: 'Varianty'|trans, labelButtonAdd: 'Přidat variantu'|trans }) }}
		</div>
	{% endif %}
{% endblock %}

{% block product_catnum %}
	{% if product.isMainVariant %}
		{{ form_row(form.productData.catnum, { label: 'Katalogové číslo'|trans, disabledField: { title: 'Tuto položku můžete nastavit na kartě konkrétní varianty'|trans, class: 'form-line__disabled' } }) }}
	{% else %}
		{{ parent() }}
	{% endif %}
{% endblock %}

{% block product_partno %}
	{% if product.isMainVariant %}
		{{ form_row(form.productData.partno, { label: 'PartNo (výrobní číslo)'|trans, disabledField: { title: 'Tuto položku můžete nastavit na kartě konkrétní varianty'|trans, class: 'form-line__disabled' } }) }}
	{% else %}
		{{ parent() }}
	{% endif %}
{% endblock %}

{% block product_ean %}
	{% if product.isMainVariant %}
		{{ form_row(form.productData.ean, { label: 'EAN'|trans, disabledField: { title: 'Tuto položku můžete nastavit na kartě konkrétní varianty'|trans, class: 'form-line__disabled' } }) }}
	{% else %}
		{{ parent() }}
	{% endif %}
{% endblock %}

{% block product_stock_and_availability %}
	{% if product.isMainVariant %}
		{{ form_row(form.productData.usingStock, { label: 'Používat skladové zásoby'|trans, disabledField: { title: 'Tuto položku můžete nastavit na kartě konkrétní varianty'|trans, class: 'form-line__disabled' } }) }}
		<div class="js-product-using-stock form-line__js">
			{{ form_row(form.productData.stockQuantity, { label: 'Skladem'|trans, disabledField: { title: 'Tuto položku můžete nastavit na kartě konkrétní varianty'|trans, class: 'form-line__disabled' } }) }}
			{{ form_row(form.productData.outOfStockAction, { label: 'Akce při vyprodání'|trans, disabledField: { title: 'Tuto položku můžete nastavit na kartě konkrétní varianty'|trans, class: 'form-line__disabled' } }) }}
			<div class="js-product-using-stock-and-alternate-availability">
				{{ form_row(form.productData.outOfStockAvailability, { label: 'Dostupnost při vyprodání'|trans, disabledField: { title: 'Tuto položku můžete nastavit na kartě konkrétní varianty'|trans, class: 'form-line__disabled' } }) }}
			</div>
		</div>
		<div class="js-product-not-using-stock form-line__js">
			{{ form_row(form.productData.availability, { label: 'Dostupnost'|trans, disabledField: { title: 'Tuto položku můžete nastavit na kartě konkrétní varianty'|trans, class: 'form-line__disabled' } }) }}
		</div>
	{% else %}
		{{ parent() }}
	{% endif %}
{% endblock %}

{% block product_calculated_hidden_info %}
	{% if product.isUsingStock and product.calculatedHidden and product.stockQuantity <= 0 %}
		<div class="form-line">
			<div class="form-line__line form-line__line--no-space">
				<div class="in-message in-message--warning">
					<span class="in-message__icon svg svg-warning"></span>
					{{ 'Produkt je skrytý z důvodu vyprodání'|trans }}
				</div>
			</div>
		</div>
	{% endif %}
{% endblock %}

{% block product_calculated_selling_denied_info %}
	{% if product.isUsingStock and product.calculatedSellingDenied and product.stockQuantity <= 0 %}
		<div class="form-line">
			<div class="form-line__line form-line__line--no-space">
				<div class="in-message in-message--warning">
					<span class="in-message__icon svg svg-warning"></span>
					{{ 'Produkt je vyřazen z prodeje z důvodu vyprodání'|trans }}
				</div>
			</div>
		</div>
	{% endif %}
{% endblock %}

{% block product_main_categories %}
	<div class="form-line">

		<label class="form-line__label">{{ 'Hlavní kategorie na doménách :' |trans }}</label>

		{% for domainId, mainCategory in productMainCategoriesIndexedByDomainId %}
			<div class="form-line__line">
				{% if mainCategory is null %}
					{% set mainCategoryName = '-' %}
				{% else %}
					{% set mainCategoryName = mainCategory.name %}
				{% endif %}

				<label class="form-line__label">
					{{ getDomainName(domainId) ~ ' :' }}
				</label>

				<div class="form-line__side">
					<div class="form-line__item wrap__input">
						<input
							type="text"
							value="{{ mainCategoryName }}"
							class="input input--domain"
							readonly="readonly"
						>
						<span class="input__domain">
							{{ domainIcon(domainId) }}
						</span>
					</div>
				</div>
			</div>
		{% endfor %}
	</div>

{% endblock %}

{% block product_categories %}
	{% if product.isVariant %}
		{% do form.productData.categoriesByDomainId.setRendered %}
		<div class="form-line">
			{{ form_label(form.productData.categoriesByDomainId, 'Přiřazení do kategorie'|trans) }}
			<div class="form-line__line">
				<div class="form-line__item">
					{{ 'Kategorie můžete nastavit na kartě hlavního zboží'|trans }}
				</div>
			</div>
		</div>
	{% else %}
		{{ parent() }}
	{% endif %}
{% endblock %}

{% block product_pricing %}
	{% if product.isMainVariant %}
		<div class="form-line form-line--disabled">
			<div class="form-line__item form-line__item--text">
				<strong>{{ 'Ceny můžete nastavit na kartě konkrétní varianty.'|trans }}</strong>
			</div>
		</div>
		{% do form.productData.priceCalculationType.setRendered %}
		{% do form.productData.vat.setRendered %}
		{% do form.productData.price.setRendered %}
		{% do form.manualInputPrices.setRendered %}
	{% else %}
		{{ parent() }}
	{% endif %}
{% endblock %}

{% block product_calculated_prices %}
	<div class="table-form__wrap">
		<table class="table-form">
			<thead>
				<tr class="table-form__row">
					<th class="table-form__cell table-form__cell--label">
						{{ inputPriceLabel({ isSimple: true }) }}
					</th>
					<th class="table-form__cell table-form__cell--field"></th>
					<th class="table-form__cell">{{ 'Cena bez DPH'|trans }}</th>
					<th class="table-form__cell">{{ 'Cena s DPH'|trans }}</th>
				</tr>
			</thead>
			<tbody>
				<tr class="table-form__row js-input-price-type-auto">
					<td class="table-form__cell table-form__cell--label">
						{{ form_label(form.productData.price, 'Základní cena'|trans, { isSimple: true } ) }}
					</td>
					<td class="table-form__cell table-form__cell--filed">
						{{ form_widget(form.productData.price, { symbolAfterInput: currencySymbolDefault() }) }}
						{{ form_errors(form.productData.price) }}
					</td>
					{% if productDetail.product.priceCalculationType == constant('SS6\\ShopBundle\\Model\\Product\\Product::PRICE_CALCULATION_TYPE_AUTO') %}
						<td class="table-form__cell">{{ productDetail.basePrice.priceWithoutVat|priceWithCurrencyAdmin }}</td>
						<td class="table-form__cell"><strong>{{ productDetail.basePrice.priceWithVat|priceWithCurrencyAdmin }}</strong></td>
					{% else %}
						<td class="table-form__cell">-</td>
						<td class="table-form__cell"><strong>-</strong></td>
					{% endif %}
				</tr>
				{% for domainId, productSellingPrices in productSellingPricesIndexedByDomainId %}
					<tr class="table-form__row table-form__row--group">
						<th class="table-form__cell" colspan="4">
							<span class="table-form__cell__image">
								{{ domainIcon(domainId, 'large') }}
							</span>
							<strong class="table-form__cell__group-name">
								{{ getDomainName(domainId) }}
							</strong>
						</th>
					</tr>
					{% for productSellingPrice in productSellingPrices %}
						<tr class="table-form__row">
							<td class="table-form__cell table-form__cell--label">
								{{ form_label(form.manualInputPrices[productSellingPrice.pricingGroup.id], productSellingPrice.pricingGroup.name, { isSimple: true }) }}
							</td>
							<td class="table-form__cell table-form__cell--filed js-input-price-type-manual">
								{{ form_widget(form.manualInputPrices[productSellingPrice.pricingGroup.id], { symbolAfterInput: currencySymbolByDomainId(domainId) }) }}
								{{ form_errors(form.manualInputPrices[productSellingPrice.pricingGroup.id]) }}
							</td>
							<td class="table-form__cell js-input-price-type-auto"></td>
							<td class="table-form__cell">
								{{ productSellingPrice.sellingPrice.priceWithoutVat|priceWithCurrencyByDomainId(domainId) }}
							</td>
							<td class="table-form__cell">
								<strong>{{ productSellingPrice.sellingPrice.priceWithVat|priceWithCurrencyByDomainId(domainId) }}</strong>
							</td>
						</tr>
					{% endfor %}
				{% endfor %}
			</tbody>
		</table>
	</div>
{% endblock %}

{% block product_description %}
	<div class="form-group__title">
		{{ 'Popis'|trans }}
	</div>
	{% if product.isVariant %}
		<div class="form-line form-line--disabled">
			<div class="form-line__item form-line__item--text">
				<strong>{{ 'Popis můžete nastavit na kartě hlavního zboží.'|trans }}</strong>
			</div>
		</div>
		{% do form.descriptions.setRendered %}
	{% else %}
		{% for domainId, descriptionForm in form.descriptions %}
			<div class="form-line form-line--no-padd">
				<div class="form-line__group">
					<span class="form-line__group__image">
						{{ domainIcon(domainId, 'large') }}
					</span>
					<strong class="form-line__group__name">{{ getDomainName(domainId) }}</strong>
				</div>
			</div>
			<div class="form-line">
				<div class="form-line__line form-line__line--no-space">
					{{ form_widget(descriptionForm) }}
				</div>
			</div>
		{% endfor %}
	{% endif %}
{% endblock %}

{% block images %}
	{% if form.imagePositions|length > 0 %}
		<div class="list-images__wrap">
			<ul class="list-images" id="js-product-images">
				{% for imageForm in form.imagePositions %}
					{% set image = productDetail.imagesIndexedById[imageForm.vars.value] %}
					<li class="list-images__item js-product-images-image" data-id="{{ image.id }}">
						<div class="list-images__item__in">
							<div class="list-images__item__image js-product-images-preview">
								{{ image(image, {size: 'original', height: '100'}) }}
							</div>
							<span class="list-images__item__main">
								{{ 'Hlavní obrázek'|trans }}
							</span>
							<button class="js-product-images-delete-button btn-no-style list-images__item__remove" type="button" title="{{ 'Smazat'|trans }}">
								<i class="svg svg-circle-cross"></i>
							</button>
							<span class="js-product-images-image-handle list-images__item__move" title="{{ 'Přesunout'|trans }}">
								<i class="svg svg-move"></i>
							</span>
							<button class="btn-no-style js-product-images-delete-revert-button display-none list-images__item__revert" type="button" title="{{ 'Vrátit zpět'|trans }}">
								<i class="svg svg-forward-page"></i>
							</button>
							<span class="list-images__item__overlay js-product-images-image-overlay">{{ 'Po uložení bude obrázek smazán'|trans }}</span>
						</div>
						{# Ignore indices from form definition. Let them reflect new positions. #}
						{{ form_widget(imageForm, { full_name: form.imagePositions.vars.full_name ~ '[]'}) }}
					</li>
				{% endfor %}
			</ul>
		</div>
	{% endif %}
	{% do form.imagePositions.setRendered %}
{% endblock %}

{% block product_urls %}
	{{ form_row(form.urls, { label: 'Nastavení URL'|trans }) }}
{% endblock %}